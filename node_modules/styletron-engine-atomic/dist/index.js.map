{"version":3,"file":"index.js","sources":["../src/sequential-id-generator.js","../src/sort-css-media-queries.js","../src/cache.js","../src/hyphenate-style-name.js","../src/validate-no-mixed-hand.js","../src/inject-style-prefixed.js","../src/validate-keyframes-object.js","../src/css.js","../src/dev-tool.js","../src/client/client.js","../src/server/server.js"],"sourcesContent":["// @flow\n\nexport default class SequentialIDGenerator {\n  prefix: string;\n  count: number;\n  offset: number;\n  msb: number;\n  power: number;\n\n  constructor(prefix: string = \"\") {\n    // ensure start with \"ae\" so \"ad\" is never produced\n    this.prefix = prefix;\n    this.count = 0;\n    this.offset = 374;\n    this.msb = 1295;\n    this.power = 2;\n  }\n\n  next() {\n    const id = this.increment().toString(36);\n    return this.prefix ? `${this.prefix}${id}` : id;\n  }\n\n  increment() {\n    const id = this.count + this.offset;\n    if (id === this.msb) {\n      this.offset += (this.msb + 1) * 9;\n      this.msb = Math.pow(36, ++this.power) - 1;\n    }\n    this.count++;\n    return id;\n  }\n}\n","// adapted from https://github.com/dutchenkoOleg/sort-css-media-queries\n\n// @flow\n\nconst minMaxWidth = /(!?\\(\\s*min(-device-)?-width).+\\(\\s*max(-device)?-width/i;\nconst minWidth = /\\(\\s*min(-device)?-width/i;\nconst maxMinWidth = /(!?\\(\\s*max(-device)?-width).+\\(\\s*min(-device)?-width/i;\nconst maxWidth = /\\(\\s*max(-device)?-width/i;\n\nconst isMinWidth = _testQuery(minMaxWidth, maxMinWidth, minWidth);\nconst isMaxWidth = _testQuery(maxMinWidth, minMaxWidth, maxWidth);\n\nconst minMaxHeight = /(!?\\(\\s*min(-device)?-height).+\\(\\s*max(-device)?-height/i;\nconst minHeight = /\\(\\s*min(-device)?-height/i;\nconst maxMinHeight = /(!?\\(\\s*max(-device)?-height).+\\(\\s*min(-device)?-height/i;\nconst maxHeight = /\\(\\s*max(-device)?-height/i;\n\nconst isMinHeight = _testQuery(minMaxHeight, maxMinHeight, minHeight);\nconst isMaxHeight = _testQuery(maxMinHeight, minMaxHeight, maxHeight);\n\nconst isPrint = /print/i;\nconst isPrintOnly = /^print$/i;\nconst maxValue = Number.MAX_VALUE;\n\nfunction _getQueryLength(length: string) {\n  const matches = /(-?\\d*\\.?\\d+)(ch|em|ex|px|rem)/.exec(length);\n  if (matches === null) {\n    return maxValue;\n  }\n  let number = matches[1];\n  const unit = matches[2];\n  switch (unit) {\n    case \"ch\":\n      number = parseFloat(number) * 8.8984375;\n      break;\n    case \"em\":\n    case \"rem\":\n      number = parseFloat(number) * 16;\n      break;\n    case \"ex\":\n      number = parseFloat(number) * 8.296875;\n      break;\n    case \"px\":\n      number = parseFloat(number);\n      break;\n  }\n  return +number;\n}\n\nfunction _testQuery(\n  doubleTestTrue: RegExp,\n  doubleTestFalse: RegExp,\n  singleTest: RegExp,\n) {\n  return function(query: string) {\n    if (doubleTestTrue.test(query)) {\n      return true;\n    } else if (doubleTestFalse.test(query)) {\n      return false;\n    }\n    return singleTest.test(query);\n  };\n}\n\nfunction _testIsPrint(a: string, b: string) {\n  const isPrintA = isPrint.test(a);\n  const isPrintOnlyA = isPrintOnly.test(a);\n  const isPrintB = isPrint.test(b);\n  const isPrintOnlyB = isPrintOnly.test(b);\n\n  if (isPrintA && isPrintB) {\n    if (!isPrintOnlyA && isPrintOnlyB) {\n      return 1;\n    }\n    if (isPrintOnlyA && !isPrintOnlyB) {\n      return -1;\n    }\n    return a.localeCompare(b);\n  }\n  if (isPrintA) {\n    return 1;\n  }\n  if (isPrintB) {\n    return -1;\n  }\n  return null;\n}\n\nexport default function sortCSSmq(a: string, b: string) {\n  if (a === \"\") {\n    return -1;\n  }\n  if (b === \"\") {\n    return 1;\n  }\n  const testIsPrint = _testIsPrint(a, b);\n  if (testIsPrint !== null) {\n    return testIsPrint;\n  }\n\n  const minA = isMinWidth(a) || isMinHeight(a);\n  const maxA = isMaxWidth(a) || isMaxHeight(a);\n  const minB = isMinWidth(b) || isMinHeight(b);\n  const maxB = isMaxWidth(b) || isMaxHeight(b);\n\n  if (minA && maxB) {\n    return -1;\n  }\n  if (maxA && minB) {\n    return 1;\n  }\n\n  const lengthA = _getQueryLength(a);\n  const lengthB = _getQueryLength(b);\n\n  if (lengthA === maxValue && lengthB === maxValue) {\n    return a.localeCompare(b);\n  } else if (lengthA === maxValue) {\n    return 1;\n  } else if (lengthB === maxValue) {\n    return -1;\n  }\n\n  if (lengthA > lengthB) {\n    if (maxA) {\n      return -1;\n    }\n    return 1;\n  }\n\n  if (lengthA < lengthB) {\n    if (maxA) {\n      return 1;\n    }\n    return -1;\n  }\n\n  return a.localeCompare(b);\n}\n","// @flow\n\nimport SequentialIDGenerator from \"./sequential-id-generator.js\";\nimport sortMq from \"./sort-css-media-queries.js\";\n\nexport class MultiCache<T> {\n  caches: {[string]: Cache<T>};\n  idGenerator: SequentialIDGenerator;\n  onNewCache: (string, Cache<T>, ?string) => any;\n  onNewValue: (cache: Cache<T>, id: string, value: T) => any;\n  sortedCacheKeys: string[];\n\n  constructor(\n    idGenerator: SequentialIDGenerator,\n    onNewCache: Function,\n    onNewValue: Function,\n  ) {\n    this.idGenerator = idGenerator;\n    this.onNewCache = onNewCache;\n    this.onNewValue = onNewValue;\n    this.sortedCacheKeys = [];\n    this.caches = {};\n  }\n\n  getCache(key: string): Cache<T> {\n    if (!this.caches[key]) {\n      const cache = new Cache(this.idGenerator, this.onNewValue);\n      cache.key = key;\n      this.sortedCacheKeys.push(key);\n      this.sortedCacheKeys.sort(sortMq);\n      const keyIndex = this.sortedCacheKeys.indexOf(key);\n      const insertBeforeMedia =\n        keyIndex < this.sortedCacheKeys.length - 1\n          ? this.sortedCacheKeys[keyIndex + 1]\n          : void 0;\n      this.caches[key] = cache;\n      this.onNewCache(key, cache, insertBeforeMedia);\n    }\n    return this.caches[key];\n  }\n\n  getSortedCacheKeys() {\n    return this.sortedCacheKeys;\n  }\n}\n\nexport class Cache<T> {\n  cache: {[string]: string};\n  idGenerator: SequentialIDGenerator;\n  key: string;\n  onNewValue: (cache: Cache<T>, id: string, value: any) => any;\n\n  constructor(\n    idGenerator: SequentialIDGenerator,\n    onNewValue: (cache: Cache<T>, id: string, value: any) => any,\n  ) {\n    this.cache = {};\n    this.idGenerator = idGenerator;\n    this.onNewValue = onNewValue;\n  }\n\n  addValue(key: string, value: T) {\n    const cached = this.cache[key];\n    if (cached) {\n      return cached;\n    }\n    const id = this.idGenerator.next();\n    this.cache[key] = id;\n    this.onNewValue(this, id, value);\n    return id;\n  }\n}\n","// @flow\n\nconst uppercasePattern = /[A-Z]/g;\nconst msPattern = /^ms-/;\nconst cache = {};\n\nexport default function hyphenateStyleName(prop: string): string {\n  return prop in cache\n    ? cache[prop]\n    : (cache[prop] = prop\n        .replace(uppercasePattern, \"-$&\")\n        .toLowerCase()\n        .replace(msPattern, \"-ms-\"));\n}\n","// @flow\n\n/**\n * Adapted from https://github.com/gilmoreorless/css-shorthand-properties\n */\n\nimport hyphenate from \"./hyphenate-style-name.js\";\n\nconst shorthandMap = {\n  // CSS 2.1: https://www.w3.org/TR/CSS2/propidx.html\n  \"list-style\": [\"list-style-type\", \"list-style-position\", \"list-style-image\"],\n  margin: [\"margin-top\", \"margin-right\", \"margin-bottom\", \"margin-left\"],\n  outline: [\"outline-width\", \"outline-style\", \"outline-color\"],\n  padding: [\"padding-top\", \"padding-right\", \"padding-bottom\", \"padding-left\"],\n\n  // CSS Backgrounds and Borders Module Level 3: https://www.w3.org/TR/css3-background/\n  background: [\n    \"background-image\",\n    \"background-position\",\n    \"background-size\",\n    \"background-repeat\",\n    \"background-origin\",\n    \"background-clip\",\n    \"background-attachment\",\n    \"background-color\",\n  ],\n  border: [\n    \"border-top-width\",\n    \"border-right-width\",\n    \"border-bottom-width\",\n    \"border-left-width\",\n    \"border-width\",\n    \"border-top-style\",\n    \"border-right-style\",\n    \"border-bottom-style\",\n    \"border-left-style\",\n    \"border-style\",\n    \"border-top-color\",\n    \"border-right-color\",\n    \"border-bottom-color\",\n    \"border-left-color\",\n    \"border-color\",\n  ],\n  \"border-color\": [\n    \"border-top-color\",\n    \"border-right-color\",\n    \"border-bottom-color\",\n    \"border-left-color\",\n  ],\n  \"border-style\": [\n    \"border-top-style\",\n    \"border-right-style\",\n    \"border-bottom-style\",\n    \"border-left-style\",\n  ],\n  \"border-width\": [\n    \"border-top-width\",\n    \"border-right-width\",\n    \"border-bottom-width\",\n    \"border-left-width\",\n  ],\n  \"border-top\": [\"border-top-width\", \"border-top-style\", \"border-top-color\"],\n  \"border-right\": [\n    \"border-right-width\",\n    \"border-right-style\",\n    \"border-right-color\",\n  ],\n  \"border-bottom\": [\n    \"border-bottom-width\",\n    \"border-bottom-style\",\n    \"border-bottom-color\",\n  ],\n  \"border-left\": [\n    \"border-left-width\",\n    \"border-left-style\",\n    \"border-left-color\",\n  ],\n  \"border-radius\": [\n    \"border-top-left-radius\",\n    \"border-top-right-radius\",\n    \"border-bottom-right-radius\",\n    \"border-bottom-left-radius\",\n  ],\n  \"border-image\": [\n    \"border-image-source\",\n    \"border-image-slice\",\n    \"border-image-width\",\n    \"border-image-outset\",\n    \"border-image-repeat\",\n  ],\n\n  // CSS Fonts Module Level 3: https://www.w3.org/TR/css3-fonts/\n  font: [\n    \"font-style\",\n    \"font-variant-ligatures\",\n    \"font-variant-alternates\",\n    \"font-variant-caps\",\n    \"font-variant-numeric\",\n    \"font-variant-east-asian\",\n    \"font-variant\",\n    \"font-weight\",\n    \"font-stretch\",\n    \"font-size\",\n    \"line-height\",\n    \"font-family\",\n  ],\n  \"font-variant\": [\n    \"font-variant-ligatures\",\n    \"font-variant-alternates\",\n    \"font-variant-caps\",\n    \"font-variant-numeric\",\n    \"font-variant-east-asian\",\n  ],\n\n  // CSS Flexible Box Layout Module Level 1: https://www.w3.org/TR/css3-flexbox-1/\n  flex: [\"flex-grow\", \"flex-shrink\", \"flex-basis\"],\n  \"flex-flow\": [\"flex-direction\", \"flex-wrap\"],\n\n  // CSS Grid Layout Module Level 1: https://www.w3.org/TR/css-grid-1/\n  grid: [\n    \"grid-template-rows\",\n    \"grid-template-columns\",\n    \"grid-template-areas\",\n    \"grid-auto-rows\",\n    \"grid-auto-columns\",\n    \"grid-auto-flow\",\n  ],\n  \"grid-template\": [\n    \"grid-template-rows\",\n    \"grid-template-columns\",\n    \"grid-template-areas\",\n  ],\n  \"grid-row\": [\"grid-row-start\", \"grid-row-end\"],\n  \"grid-column\": [\"grid-column-start\", \"grid-column-end\"],\n  \"grid-area\": [\n    \"grid-row-start\",\n    \"grid-column-start\",\n    \"grid-row-end\",\n    \"grid-column-end\",\n  ],\n  \"grid-gap\": [\"grid-row-gap\", \"grid-column-gap\"],\n\n  // CSS Masking Module Level 1: https://www.w3.org/TR/css-masking/\n  mask: [\n    \"mask-image\",\n    \"mask-mode\",\n    \"mask-position\",\n    \"mask-size\",\n    \"mask-repeat\",\n    \"mask-origin\",\n    \"mask-clip\",\n  ],\n  \"mask-border\": [\n    \"mask-border-source\",\n    \"mask-border-slice\",\n    \"mask-border-width\",\n    \"mask-border-outset\",\n    \"mask-border-repeat\",\n    \"mask-border-mode\",\n  ],\n\n  // CSS Multi-column Layout Module: https://www.w3.org/TR/css3-multicol/\n  columns: [\"column-width\", \"column-count\"],\n  \"column-rule\": [\n    \"column-rule-width\",\n    \"column-rule-style\",\n    \"column-rule-color\",\n  ],\n\n  // CSS Scroll Snap Module Level 1: https://www.w3.org/TR/css-scroll-snap-1/\n  \"scroll-padding\": [\n    \"scroll-padding-top\",\n    \"scroll-padding-right\",\n    \"scroll-padding-bottom\",\n    \"scroll-padding-left\",\n  ],\n  \"scroll-padding-block\": [\n    \"scroll-padding-block-start\",\n    \"scroll-padding-block-end\",\n  ],\n  \"scroll-padding-inline\": [\n    \"scroll-padding-inline-start\",\n    \"scroll-padding-inline-end\",\n  ],\n  \"scroll-snap-margin\": [\n    \"scroll-snap-margin-top\",\n    \"scroll-snap-margin-right\",\n    \"scroll-snap-margin-bottom\",\n    \"scroll-snap-margin-left\",\n  ],\n  \"scroll-snap-margin-block\": [\n    \"scroll-snap-margin-block-start\",\n    \"scroll-snap-margin-block-end\",\n  ],\n  \"scroll-snap-margin-inline\": [\n    \"scroll-snap-margin-inline-start\",\n    \"scroll-snap-margin-inline-end\",\n  ],\n\n  // CSS Speech Module: https://www.w3.org/TR/css3-speech/\n  cue: [\"cue-before\", \"cue-after\"],\n  pause: [\"pause-before\", \"pause-after\"],\n  rest: [\"rest-before\", \"rest-after\"],\n\n  // CSS Text Decoration Module Level 3: https://www.w3.org/TR/css-text-decor-3/\n  \"text-decoration\": [\n    \"text-decoration-line\",\n    \"text-decoration-style\",\n    \"text-decoration-color\",\n  ],\n  \"text-emphasis\": [\"text-emphasis-style\", \"text-emphasis-color\"],\n\n  // CSS Animations (WD): https://www.w3.org/TR/css3-animations\n  animation: [\n    \"animation-name\",\n    \"animation-duration\",\n    \"animation-timing-function\",\n    \"animation-delay\",\n    \"animation-iteration-count\",\n    \"animation-direction\",\n    \"animation-fill-mode\",\n    \"animation-play-state\",\n  ],\n\n  // CSS Transitions (WD): https://www.w3.org/TR/css3-transitions/\n  transition: [\n    \"transition-property\",\n    \"transition-duration\",\n    \"transition-timing-function\",\n    \"transition-delay\",\n  ],\n};\n\nexport function validateNoMixedHand(style: Object) {\n  const hyphenatedProperties = Object.keys(style).reduce((acc, property) => {\n    acc[hyphenate(property)] = property;\n    return acc;\n  }, {});\n\n  const mixed = [];\n  for (const property in hyphenatedProperties) {\n    if (property in shorthandMap) {\n      for (const longhand of shorthandMap[property]) {\n        if (longhand in hyphenatedProperties) {\n          const long = hyphenatedProperties[longhand];\n          const short = hyphenatedProperties[property];\n          mixed.push({\n            shorthand: {property: short, value: style[short]},\n            longhand: {property: long, value: style[long]},\n          });\n        }\n      }\n    }\n  }\n  return mixed;\n}\n","// @flow\n\ndeclare var __DEV__: boolean;\n\nimport hyphenate from \"./hyphenate-style-name.js\";\nimport {validateNoMixedHand} from \"./validate-no-mixed-hand.js\";\nimport {prefix} from \"inline-style-prefixer\";\n\nimport type {StyleObject} from \"styletron-standard\";\n\nimport {MultiCache} from \"./cache.js\";\n\nexport default function injectStylePrefixed(\n  styleCache: MultiCache<{pseudo: string, block: string}>,\n  styles: StyleObject,\n  media: string,\n  pseudo: string,\n) {\n  const cache = styleCache.getCache(media);\n  let classString = \"\";\n  for (const originalKey in styles) {\n    const originalVal = styles[originalKey];\n\n    if (originalVal === void 0 || originalVal === null) {\n      continue;\n    }\n    if (typeof originalVal !== \"object\") {\n      // Non-null and non-undefined primitive value\n      if (__DEV__) {\n        validateValueType(originalVal, originalKey);\n      }\n\n      const propValPair = `${hyphenate(\n        originalKey,\n      )}:${((originalVal: any): string)}`;\n      const key = `${pseudo}${propValPair}`;\n      const cachedId = cache.cache[key];\n      if (cachedId !== void 0) {\n        // cache hit\n        classString += \" \" + cachedId;\n        continue;\n      } else {\n        // cache miss\n        let block = \"\";\n        const prefixed = prefix({[originalKey]: originalVal});\n        for (const prefixedKey in prefixed) {\n          const prefixedVal = prefixed[prefixedKey];\n          const prefixedValType = typeof prefixedVal;\n          if (prefixedValType === \"string\" || prefixedValType === \"number\") {\n            const prefixedPair = `${hyphenate(prefixedKey)}:${prefixedVal}`;\n            if (prefixedPair !== propValPair) {\n              block += `${prefixedPair};`;\n            }\n          } else if (Array.isArray(prefixedVal)) {\n            const hyphenated = hyphenate(prefixedKey);\n            for (let i = 0; i < prefixedVal.length; i++) {\n              const prefixedPair = `${hyphenated}:${prefixedVal[i]}`;\n              if (prefixedPair !== propValPair) {\n                block += `${prefixedPair};`;\n              }\n            }\n          }\n        }\n        block += propValPair; // ensure original prop/val is last (for hydration)\n        const id = cache.addValue(key, {pseudo, block});\n        classString += \" \" + id;\n      }\n    } else {\n      // Non-null object value\n      if (originalKey[0] === \":\") {\n        classString +=\n          \" \" +\n          injectStylePrefixed(\n            styleCache,\n            originalVal,\n            media,\n            pseudo + originalKey,\n          );\n      } else if (originalKey.substring(0, 6) === \"@media\") {\n        classString +=\n          \" \" +\n          injectStylePrefixed(\n            styleCache,\n            originalVal,\n            originalKey.substr(7),\n            pseudo,\n          );\n      }\n    }\n  }\n\n  if (__DEV__) {\n    const conflicts = validateNoMixedHand(styles);\n    if (conflicts.length) {\n      conflicts.forEach(({shorthand, longhand}) => {\n        const short = JSON.stringify({[shorthand.property]: shorthand.value});\n        const long = JSON.stringify({[longhand.property]: longhand.value});\n        // eslint-disable-next-line no-console\n        console.warn(\n          `Styles \\`${short}\\` and \\`${long}\\` in object yielding class \"${classString.slice(\n            1,\n          )}\" may result in unexpected behavior. Mixing shorthand and longhand properties within the same style object is unsupported with atomic rendering.`,\n        );\n      });\n    }\n  }\n\n  // remove leading space\n  return classString.slice(1);\n}\n\nfunction validateValueType(value, key) {\n  if (\n    value === null ||\n    Array.isArray(value) ||\n    (typeof value !== \"number\" && typeof value !== \"string\")\n  ) {\n    throw new Error(\n      `Unsupported style value: ${JSON.stringify(\n        value,\n      )} used in property ${JSON.stringify(key)}`,\n    );\n  }\n}\n","// @flow\n\n/* eslint-disable no-console */\n\nconst validAnimationState = /^(from|to|\\+?(\\d*\\.)?\\d+%)(\\s*,\\s*(from|to|\\+?(\\d*\\.)?\\d+%))*$/;\n\nexport default function validateKeyframesObject(keyframes: Object) {\n  let valid = true;\n  for (const animationState in keyframes) {\n    const value = keyframes[animationState];\n    if (!validAnimationState.test(animationState)) {\n      valid = false;\n      console.warn(\n        `Warning: property \"${animationState}\" in keyframes object ${JSON.stringify(\n          keyframes,\n        )} is not a valid. Must be \"from\", \"to\", or a percentage.`,\n      );\n    }\n    if (typeof value !== \"object\") {\n      valid = false;\n      console.warn(\n        `Warning: value for \"${animationState}\" property in keyframes object ${JSON.stringify(\n          keyframes,\n        )} must be an object. Instead it was a ${typeof value}.`,\n      );\n    }\n    if (!valid) {\n      console.warn(\n        `Warning: object used as value for \"animationName\" style is invalid:`,\n        keyframes,\n      );\n    }\n  }\n}\n","// @flow\n\ndeclare var __DEV__: boolean;\n\nimport hyphenate from \"./hyphenate-style-name.js\";\nimport validateKeyframesObject from \"./validate-keyframes-object.js\";\n\nexport function atomicSelector(id: string, pseudo: string): string {\n  let selector = `.${id}`;\n  if (pseudo) {\n    selector += pseudo;\n  }\n  return selector;\n}\n\nexport function keyframesToBlock(keyframes: {[string]: Object}): string {\n  if (__DEV__) {\n    validateKeyframesObject(keyframes);\n  }\n  if (__DEV__ && typeof Object.getPrototypeOf(keyframes) !== \"undefined\") {\n    if (Object.getPrototypeOf(keyframes) !== Object.getPrototypeOf({})) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        \"Only plain objects should be used as animation values. Unexpectedly recieved:\",\n        keyframes,\n      );\n    }\n  }\n  let result = \"\";\n  for (const animationState in keyframes) {\n    result += `${animationState}{${declarationsToBlock(\n      keyframes[animationState],\n    )}}`;\n  }\n  return result;\n}\n\nexport function declarationsToBlock(style: Object): string {\n  let css = \"\";\n  for (const prop in style) {\n    const val = style[prop];\n    if (typeof val === \"string\" || typeof val === \"number\") {\n      css += `${hyphenate(prop)}:${val};`;\n    }\n  }\n  // trim trailing semicolon\n  return css.slice(0, -1);\n}\n\nexport function keyframesBlockToRule(id: string, block: string): string {\n  return `@keyframes ${id}{${block}}`;\n}\n\nexport function fontFaceBlockToRule(id: string, block: string): string {\n  return `@font-face{font-family:${id};${block}}`;\n}\n\nexport function styleBlockToRule(selector: string, block: string): string {\n  return `${selector}{${block}}`;\n}\n","/* eslint-env browser */\nexport const insertRuleIntoDevtools = (selector, block) => {\n  // start after the . combinator and cut at the first : if there is one to cut out the pseudo classes\n  const key = selector.substring(\n    1,\n    selector.indexOf(\":\") !== -1 ? selector.indexOf(\":\") : selector.length,\n  );\n  const styles = {};\n  // split the declaration to catch vendor prefixing\n  for (const decl of block.split(\";\")) {\n    if (decl.trim() !== \"\" && !window.__STYLETRON_DEVTOOLS__.atomicMap[key])\n      styles[decl.substring(0, decl.indexOf(\":\"))] = decl.substring(\n        decl.indexOf(\":\") + 1,\n        decl.length,\n      );\n  }\n\n  window.__STYLETRON_DEVTOOLS__.atomicMap[key] = styles;\n};\n\nexport const hydrateDevtoolsRule = cssString => {\n  const id = cssString.substring(0, 3);\n  const block = cssString.substring(4, cssString.length - 1);\n  insertRuleIntoDevtools(id, block);\n};\n","// @flow\n\n/* eslint-env browser */\n\ndeclare var __DEV__: boolean;\ndeclare var __BROWSER__: boolean;\n\nconst STYLES_HYDRATOR = /\\.([^{:]+)(:[^{]+)?{(?:[^}]*;)?([^}]*?)}/g;\nconst KEYFRAMES_HYRDATOR = /@keyframes ([^{]+)\\{((?:[^{]+\\{[^}]*\\})*)\\}/g;\nconst FONT_FACE_HYDRATOR = /@font-face\\{font-family:([^;]+);([^}]*)\\}/g;\n\ntype hydratorT =\n  | typeof STYLES_HYDRATOR\n  | typeof KEYFRAMES_HYRDATOR\n  | typeof FONT_FACE_HYDRATOR;\n\nfunction hydrateStyles<T>(cache: Cache<T>, hydrator: hydratorT, css: string) {\n  let match;\n  while ((match = hydrator.exec(css))) {\n    const [, id, pseudo, key] = match;\n    if (__BROWSER__ && __DEV__ && window.__STYLETRON_DEVTOOLS__) {\n      hydrateDevtoolsRule(match[0]);\n    }\n    const fullKey = pseudo ? `${pseudo}${key}` : key;\n    cache.cache[fullKey] = id; // set cache without triggering side effects\n    cache.idGenerator.increment(); // increment id\n  }\n}\n\nfunction hydrate<T>(cache: Cache<T>, hydrator: hydratorT, css: string) {\n  let match;\n  while ((match = hydrator.exec(css))) {\n    const [, id, key] = match;\n    if (__BROWSER__ && __DEV__ && window.__STYLETRON_DEVTOOLS__) {\n      hydrateDevtoolsRule(match[0]);\n    }\n    cache.cache[key] = id; // set cache without triggering side effects\n    cache.idGenerator.increment(); // increment id\n  }\n}\n\nimport SequentialIDGenerator from \"../sequential-id-generator.js\";\n\nimport type {\n  StandardEngine,\n  KeyframesObject,\n  FontFaceObject,\n  StyleObject,\n} from \"styletron-standard\";\n\nimport {Cache, MultiCache} from \"../cache.js\";\n\nimport injectStylePrefixed from \"../inject-style-prefixed.js\";\n\nimport {\n  styleBlockToRule,\n  atomicSelector,\n  keyframesBlockToRule,\n  declarationsToBlock,\n  keyframesToBlock,\n  fontFaceBlockToRule,\n} from \"../css.js\";\nimport {insertRuleIntoDevtools, hydrateDevtoolsRule} from \"../dev-tool.js\";\n\ntype hydrateT =\n  | HTMLCollection<HTMLStyleElement>\n  | Array<HTMLStyleElement>\n  | NodeList<HTMLStyleElement>;\n\ntype optionsT = {\n  hydrate?: hydrateT,\n  container?: Element,\n  prefix?: string,\n};\n\nclass StyletronClient implements StandardEngine {\n  container: Element;\n  styleElements: {[string]: HTMLStyleElement};\n  fontFaceSheet: HTMLStyleElement;\n  keyframesSheet: HTMLStyleElement;\n\n  styleCache: MultiCache<{pseudo: string, block: string}>;\n  keyframesCache: Cache<KeyframesObject>;\n  fontFaceCache: Cache<FontFaceObject>;\n\n  constructor(opts?: optionsT = {}) {\n    this.styleElements = {};\n\n    const styleIdGenerator = new SequentialIDGenerator(opts.prefix);\n    const onNewStyle = (cache, id, value) => {\n      const {pseudo, block} = value;\n      const sheet: CSSStyleSheet = (this.styleElements[cache.key].sheet: any);\n      const selector = atomicSelector(id, pseudo);\n      const rule = styleBlockToRule(selector, block);\n      try {\n        sheet.insertRule(rule, sheet.cssRules.length);\n        if (__BROWSER__ && __DEV__ && window.__STYLETRON_DEVTOOLS__) {\n          insertRuleIntoDevtools(selector, block);\n        }\n      } catch (e) {\n        if (__DEV__) {\n          // eslint-disable-next-line no-console\n          console.warn(\n            `Failed to inject CSS: \"${rule}\". Perhaps this has invalid or un-prefixed properties?`,\n          );\n        }\n      }\n    };\n\n    // Setup style cache\n    this.styleCache = new MultiCache(\n      styleIdGenerator,\n      (media, _cache, insertBeforeMedia) => {\n        const styleElement = document.createElement(\"style\");\n        styleElement.media = media;\n        if (insertBeforeMedia === void 0) {\n          this.container.appendChild(styleElement);\n        } else {\n          const insertBeforeIndex = findSheetIndexWithMedia(\n            this.container.children,\n            insertBeforeMedia,\n          );\n          this.container.insertBefore(\n            styleElement,\n            this.container.children[insertBeforeIndex],\n          );\n        }\n\n        this.styleElements[media] = styleElement;\n      },\n      onNewStyle,\n    );\n\n    this.keyframesCache = new Cache(\n      new SequentialIDGenerator(opts.prefix),\n      (cache, id, value) => {\n        this.styleCache.getCache(\"\");\n        const sheet: CSSStyleSheet = (this.styleElements[\"\"].sheet: any);\n        const rule = keyframesBlockToRule(id, keyframesToBlock(value));\n        try {\n          sheet.insertRule(rule, sheet.cssRules.length);\n        } catch (e) {\n          if (__DEV__) {\n            // eslint-disable-next-line no-console\n            console.warn(\n              `Failed to inject CSS: \"${rule}\". Perhaps this has invalid or un-prefixed properties?`,\n            );\n          }\n        }\n      },\n    );\n\n    this.fontFaceCache = new Cache(\n      new SequentialIDGenerator(opts.prefix),\n      (cache, id, value) => {\n        this.styleCache.getCache(\"\");\n        const sheet: CSSStyleSheet = (this.styleElements[\"\"].sheet: any);\n        const rule = fontFaceBlockToRule(id, declarationsToBlock(value));\n        try {\n          sheet.insertRule(rule, sheet.cssRules.length);\n        } catch (e) {\n          if (__DEV__) {\n            // eslint-disable-next-line no-console\n            console.warn(\n              `Failed to inject CSS: \"${rule}\". Perhaps this has invalid or un-prefixed properties?`,\n            );\n          }\n        }\n      },\n    );\n\n    if (opts.container) {\n      this.container = opts.container;\n    }\n\n    // Hydrate\n    if (opts.hydrate && opts.hydrate.length > 0) {\n      // infer container from parent element\n      if (!this.container) {\n        const parentElement = opts.hydrate[0].parentElement;\n        if (parentElement !== null && parentElement !== void 0) {\n          this.container = parentElement;\n        }\n      }\n\n      for (let i = 0; i < opts.hydrate.length; i++) {\n        const element = opts.hydrate[i];\n        const hydrateType = element.getAttribute(\"data-hydrate\");\n        if (hydrateType === \"font-face\") {\n          hydrate(this.fontFaceCache, FONT_FACE_HYDRATOR, element.textContent);\n          continue;\n        }\n        if (hydrateType === \"keyframes\") {\n          hydrate(this.keyframesCache, KEYFRAMES_HYRDATOR, element.textContent);\n          continue;\n        }\n        const key = element.media ? element.media : \"\";\n        this.styleElements[key] = element;\n        const cache = new Cache(styleIdGenerator, onNewStyle);\n        cache.key = key;\n        hydrateStyles(cache, STYLES_HYDRATOR, element.textContent);\n        this.styleCache.sortedCacheKeys.push(key);\n        this.styleCache.caches[key] = cache;\n      }\n    }\n\n    if (!this.container) {\n      if (document.head === null) {\n        throw new Error(\"No container provided and `document.head` was null\");\n      }\n      this.container = document.head;\n    }\n  }\n\n  renderStyle(style: StyleObject): string {\n    return injectStylePrefixed(this.styleCache, style, \"\", \"\");\n  }\n\n  renderFontFace(fontFace: FontFaceObject): string {\n    const key = declarationsToBlock(fontFace);\n    return this.fontFaceCache.addValue(key, fontFace);\n  }\n\n  renderKeyframes(keyframes: KeyframesObject): string {\n    const key = keyframesToBlock(keyframes);\n    return this.keyframesCache.addValue(key, keyframes);\n  }\n}\n\nexport default StyletronClient;\n\nfunction findSheetIndexWithMedia(children, media) {\n  let index = 0;\n  for (; index < children.length; index++) {\n    const child = children[index];\n    if (\n      child.tagName === \"STYLE\" &&\n      ((child: any): HTMLStyleElement).media === media\n    ) {\n      return index;\n    }\n  }\n\n  return -1;\n}\n","// @flow\n\nimport SequentialIDGenerator from \"../sequential-id-generator.js\";\n\nimport type {StandardEngine} from \"styletron-standard\";\n\nimport {Cache, MultiCache} from \"../cache.js\";\n\nimport injectStylePrefixed from \"../inject-style-prefixed.js\";\n\nimport type {\n  StyleObject,\n  FontFaceObject,\n  KeyframesObject,\n} from \"styletron-standard\";\n\nimport {\n  styleBlockToRule,\n  atomicSelector,\n  keyframesBlockToRule,\n  declarationsToBlock,\n  keyframesToBlock,\n  fontFaceBlockToRule,\n} from \"../css.js\";\n\nexport type attrsT = {\n  \"data-hydrate\"?: \"keyframes\" | \"font-face\",\n  media?: string,\n  class?: string,\n};\n\nexport type sheetT = {|\n  css: string,\n  attrs: attrsT,\n|};\n\ntype optionsT = {\n  prefix?: string,\n};\n\nclass StyletronServer implements StandardEngine {\n  styleCache: MultiCache<{pseudo: string, block: string}>;\n  keyframesCache: Cache<KeyframesObject>;\n  fontFaceCache: Cache<FontFaceObject>;\n  styleRules: {[string]: string};\n  keyframesRules: string;\n  fontFaceRules: string;\n\n  constructor(opts?: optionsT = {}) {\n    this.styleRules = {\"\": \"\"};\n    this.styleCache = new MultiCache(\n      new SequentialIDGenerator(opts.prefix),\n      media => {\n        this.styleRules[media] = \"\";\n      },\n      (cache, id, value) => {\n        const {pseudo, block} = value;\n        this.styleRules[cache.key] += styleBlockToRule(\n          atomicSelector(id, pseudo),\n          block,\n        );\n      },\n    );\n\n    this.fontFaceRules = \"\";\n    this.fontFaceCache = new Cache(\n      new SequentialIDGenerator(opts.prefix),\n      (cache, id, value) => {\n        this.fontFaceRules += fontFaceBlockToRule(\n          id,\n          declarationsToBlock(value),\n        );\n      },\n    );\n\n    this.keyframesRules = \"\";\n    this.keyframesCache = new Cache(\n      new SequentialIDGenerator(opts.prefix),\n      (cache, id, value) => {\n        this.keyframesRules += keyframesBlockToRule(\n          id,\n          keyframesToBlock(value),\n        );\n      },\n    );\n  }\n\n  renderStyle(style: StyleObject): string {\n    return injectStylePrefixed(this.styleCache, style, \"\", \"\");\n  }\n\n  renderFontFace(fontFace: FontFaceObject): string {\n    const key = JSON.stringify(fontFace);\n    return this.fontFaceCache.addValue(key, fontFace);\n  }\n\n  renderKeyframes(keyframes: KeyframesObject): string {\n    const key = JSON.stringify(keyframes);\n    return this.keyframesCache.addValue(key, keyframes);\n  }\n\n  getStylesheets(): Array<sheetT> {\n    return [\n      ...(this.keyframesRules.length\n        ? [\n            {\n              css: this.keyframesRules,\n              attrs: {\"data-hydrate\": \"keyframes\"},\n            },\n          ]\n        : []),\n      ...(this.fontFaceRules.length\n        ? [\n            {\n              css: this.fontFaceRules,\n              attrs: {\"data-hydrate\": \"font-face\"},\n            },\n          ]\n        : []),\n      ...sheetify(this.styleRules, this.styleCache.getSortedCacheKeys()),\n    ];\n  }\n\n  getStylesheetsHtml(className?: string = \"_styletron_hydrate_\") {\n    return generateHtmlString(this.getStylesheets(), className);\n  }\n\n  getCss() {\n    return (\n      this.keyframesRules +\n      this.fontFaceRules +\n      stringify(this.styleRules, this.styleCache.getSortedCacheKeys())\n    );\n  }\n}\n\nexport function generateHtmlString(sheets: Array<sheetT>, className: string) {\n  let html = \"\";\n  for (let i = 0; i < sheets.length; i++) {\n    const sheet = sheets[i];\n    const {class: originalClassName, ...rest} = sheet.attrs;\n    const attrs = {\n      class: originalClassName\n        ? `${className} ${originalClassName}`\n        : className,\n      ...(rest: attrsT),\n    };\n    html += `<style${attrsToString(attrs)}>${sheet.css}</style>`;\n  }\n  return html;\n}\n\nfunction attrsToString(attrs: attrsT) {\n  let result = \"\";\n  for (const attr in attrs) {\n    const value = attrs[attr];\n    if (value === true) {\n      result += \" \" + attr;\n    } else if (value !== false) {\n      result += ` ${attr}=\"${value}\"`;\n    }\n  }\n  return result;\n}\n\nfunction stringify(styleRules, sortedCacheKeys) {\n  let result = \"\";\n  sortedCacheKeys.forEach(cacheKey => {\n    const rules = styleRules[cacheKey];\n    if (cacheKey !== \"\") {\n      result += `@media ${cacheKey}{${rules}}`;\n    } else {\n      result += rules;\n    }\n  });\n  return result;\n}\n\nfunction sheetify(styleRules, sortedCacheKeys): Array<sheetT> {\n  if (sortedCacheKeys.length === 0) {\n    return [{css: \"\", attrs: {}}];\n  }\n  const sheets = [];\n  sortedCacheKeys.forEach(cacheKey => {\n    // omit media (cacheKey) attribute if empty\n    const attrs = cacheKey === \"\" ? {} : {media: cacheKey};\n    sheets.push({css: styleRules[cacheKey], attrs});\n  });\n  return sheets;\n}\n\nexport default StyletronServer;\n"],"names":["SequentialIDGenerator","prefix","count","offset","msb","power","id","increment","toString","Math","pow","minMaxWidth","minWidth","maxMinWidth","maxWidth","isMinWidth","_testQuery","isMaxWidth","minMaxHeight","minHeight","maxMinHeight","maxHeight","isMinHeight","isMaxHeight","isPrint","isPrintOnly","maxValue","Number","MAX_VALUE","_getQueryLength","length","matches","exec","number","unit","parseFloat","doubleTestTrue","doubleTestFalse","singleTest","query","test","_testIsPrint","a","b","isPrintA","isPrintOnlyA","isPrintB","isPrintOnlyB","localeCompare","sortCSSmq","testIsPrint","minA","maxA","minB","maxB","lengthA","lengthB","MultiCache","idGenerator","onNewCache","onNewValue","sortedCacheKeys","caches","key","cache","Cache","push","sort","sortMq","keyIndex","indexOf","insertBeforeMedia","value","cached","next","uppercasePattern","msPattern","hyphenateStyleName","prop","replace","toLowerCase","shorthandMap","validateNoMixedHand","style","hyphenatedProperties","Object","keys","reduce","acc","property","hyphenate","mixed","longhand","long","short","injectStylePrefixed","styleCache","styles","media","pseudo","getCache","classString","originalKey","originalVal","propValPair","cachedId","block","prefixed","prefixedKey","prefixedVal","prefixedValType","prefixedPair","Array","isArray","hyphenated","i","addValue","substring","substr","conflicts","forEach","JSON","stringify","shorthand","warn","slice","validateValueType","Error","validAnimationState","validateKeyframesObject","keyframes","valid","animationState","atomicSelector","selector","keyframesToBlock","getPrototypeOf","result","declarationsToBlock","css","val","keyframesBlockToRule","fontFaceBlockToRule","styleBlockToRule","STYLES_HYDRATOR","KEYFRAMES_HYRDATOR","FONT_FACE_HYDRATOR","hydrateStyles","hydrator","match","fullKey","hydrate","StyletronClient","opts","styleElements","styleIdGenerator","onNewStyle","sheet","rule","insertRule","cssRules","e","_cache","styleElement","document","createElement","container","appendChild","insertBeforeIndex","findSheetIndexWithMedia","children","insertBefore","keyframesCache","fontFaceCache","parentElement","element","hydrateType","getAttribute","textContent","head","fontFace","index","child","tagName","StyletronServer","styleRules","fontFaceRules","keyframesRules","sheetify","getSortedCacheKeys","className","generateHtmlString","getStylesheets","sheets","html","attrs","originalClassName","rest","attrsToString","attr","cacheKey","rules"],"mappings":";;;;;;AAEe,MAAMA,qBAAN,CAA4B;cAO7BC,YAAiB,EAA7B,EAAiC;;SAE1BA,MAAL,GAAcA,SAAd;SACKC,KAAL,GAAa,CAAb;SACKC,MAAL,GAAc,GAAd;SACKC,GAAL,GAAW,IAAX;SACKC,KAAL,GAAa,CAAb;;;SAGK;UACCC,KAAK,KAAKC,SAAL,GAAiBC,QAAjB,CAA0B,EAA1B,CAAX;WACO,KAAKP,MAAL,GAAe,GAAE,KAAKA,MAAO,GAAEK,EAAG,EAAlC,GAAsCA,EAA7C;;;cAGU;UACJA,KAAK,KAAKJ,KAAL,GAAa,KAAKC,MAA7B;;QACIG,OAAO,KAAKF,GAAhB,EAAqB;WACdD,MAAL,IAAe,CAAC,KAAKC,GAAL,GAAW,CAAZ,IAAiB,CAAhC;WACKA,GAAL,GAAWK,KAAKC,GAAL,CAAS,EAAT,EAAa,EAAE,KAAKL,KAApB,IAA6B,CAAxC;;;SAEGH,KAAL;WACOI,EAAP;;;;;AC9BJ;AAIA,MAAMK,cAAc,0DAApB;AACA,MAAMC,WAAW,2BAAjB;AACA,MAAMC,cAAc,yDAApB;AACA,MAAMC,WAAW,2BAAjB;;AAEA,MAAMC,aAAaC,WAAWL,WAAX,EAAwBE,WAAxB,EAAqCD,QAArC,CAAnB;;AACA,MAAMK,aAAaD,WAAWH,WAAX,EAAwBF,WAAxB,EAAqCG,QAArC,CAAnB;;AAEA,MAAMI,eAAe,2DAArB;AACA,MAAMC,YAAY,4BAAlB;AACA,MAAMC,eAAe,2DAArB;AACA,MAAMC,YAAY,4BAAlB;;AAEA,MAAMC,cAAcN,WAAWE,YAAX,EAAyBE,YAAzB,EAAuCD,SAAvC,CAApB;;AACA,MAAMI,cAAcP,WAAWI,YAAX,EAAyBF,YAAzB,EAAuCG,SAAvC,CAApB;;AAEA,MAAMG,UAAU,QAAhB;AACA,MAAMC,cAAc,UAApB;AACA,MAAMC,WAAWC,OAAOC,SAAxB;;AAEA,SAASC,eAAT,CAAyBC,MAAzB,EAAyC;QACjCC,UAAU,iCAAiCC,IAAjC,CAAsCF,MAAtC,CAAhB;;MACIC,YAAY,IAAhB,EAAsB;WACbL,QAAP;;;MAEEO,SAASF,QAAQ,CAAR,CAAb;QACMG,OAAOH,QAAQ,CAAR,CAAb;;UACQG,IAAR;SACO,IAAL;eACWC,WAAWF,MAAX,IAAqB,SAA9B;;;SAEG,IAAL;SACK,KAAL;eACWE,WAAWF,MAAX,IAAqB,EAA9B;;;SAEG,IAAL;eACWE,WAAWF,MAAX,IAAqB,QAA9B;;;SAEG,IAAL;eACWE,WAAWF,MAAX,CAAT;;;;SAGG,CAACA,MAAR;;;AAGF,SAASjB,UAAT,CACEoB,cADF,EAEEC,eAFF,EAGEC,UAHF,EAIE;SACO,UAASC,KAAT,EAAwB;QACzBH,eAAeI,IAAf,CAAoBD,KAApB,CAAJ,EAAgC;aACvB,IAAP;KADF,MAEO,IAAIF,gBAAgBG,IAAhB,CAAqBD,KAArB,CAAJ,EAAiC;aAC/B,KAAP;;;WAEKD,WAAWE,IAAX,CAAgBD,KAAhB,CAAP;GANF;;;AAUF,SAASE,YAAT,CAAsBC,CAAtB,EAAiCC,CAAjC,EAA4C;QACpCC,WAAWpB,QAAQgB,IAAR,CAAaE,CAAb,CAAjB;QACMG,eAAepB,YAAYe,IAAZ,CAAiBE,CAAjB,CAArB;QACMI,WAAWtB,QAAQgB,IAAR,CAAaG,CAAb,CAAjB;QACMI,eAAetB,YAAYe,IAAZ,CAAiBG,CAAjB,CAArB;;MAEIC,YAAYE,QAAhB,EAA0B;QACpB,CAACD,YAAD,IAAiBE,YAArB,EAAmC;aAC1B,CAAP;;;QAEEF,gBAAgB,CAACE,YAArB,EAAmC;aAC1B,CAAC,CAAR;;;WAEKL,EAAEM,aAAF,CAAgBL,CAAhB,CAAP;;;MAEEC,QAAJ,EAAc;WACL,CAAP;;;MAEEE,QAAJ,EAAc;WACL,CAAC,CAAR;;;SAEK,IAAP;;;AAGF,AAAe,SAASG,SAAT,CAAmBP,CAAnB,EAA8BC,CAA9B,EAAyC;MAClDD,MAAM,EAAV,EAAc;WACL,CAAC,CAAR;;;MAEEC,MAAM,EAAV,EAAc;WACL,CAAP;;;QAEIO,cAAcT,aAAaC,CAAb,EAAgBC,CAAhB,CAApB;;MACIO,gBAAgB,IAApB,EAA0B;WACjBA,WAAP;;;QAGIC,OAAOpC,WAAW2B,CAAX,KAAiBpB,YAAYoB,CAAZ,CAA9B;QACMU,OAAOnC,WAAWyB,CAAX,KAAiBnB,YAAYmB,CAAZ,CAA9B;QACMW,OAAOtC,WAAW4B,CAAX,KAAiBrB,YAAYqB,CAAZ,CAA9B;QACMW,OAAOrC,WAAW0B,CAAX,KAAiBpB,YAAYoB,CAAZ,CAA9B;;MAEIQ,QAAQG,IAAZ,EAAkB;WACT,CAAC,CAAR;;;MAEEF,QAAQC,IAAZ,EAAkB;WACT,CAAP;;;QAGIE,UAAU1B,gBAAgBa,CAAhB,CAAhB;;QACMc,UAAU3B,gBAAgBc,CAAhB,CAAhB;;MAEIY,YAAY7B,QAAZ,IAAwB8B,YAAY9B,QAAxC,EAAkD;WACzCgB,EAAEM,aAAF,CAAgBL,CAAhB,CAAP;GADF,MAEO,IAAIY,YAAY7B,QAAhB,EAA0B;WACxB,CAAP;GADK,MAEA,IAAI8B,YAAY9B,QAAhB,EAA0B;WACxB,CAAC,CAAR;;;MAGE6B,UAAUC,OAAd,EAAuB;QACjBJ,IAAJ,EAAU;aACD,CAAC,CAAR;;;WAEK,CAAP;;;MAGEG,UAAUC,OAAd,EAAuB;QACjBJ,IAAJ,EAAU;aACD,CAAP;;;WAEK,CAAC,CAAR;;;SAGKV,EAAEM,aAAF,CAAgBL,CAAhB,CAAP;;;ACpIK,MAAMc,UAAN,CAAoB;cAQvBC,WADF,EAEEC,UAFF,EAGEC,UAHF,EAIE;SACKF,WAAL,GAAmBA,WAAnB;SACKC,UAAL,GAAkBA,UAAlB;SACKC,UAAL,GAAkBA,UAAlB;SACKC,eAAL,GAAuB,EAAvB;SACKC,MAAL,GAAc,EAAd;;;WAGOC,GAAT,EAAgC;QAC1B,CAAC,KAAKD,MAAL,CAAYC,GAAZ,CAAL,EAAuB;YACfC,QAAQ,IAAIC,KAAJ,CAAU,KAAKP,WAAf,EAA4B,KAAKE,UAAjC,CAAd;YACMG,GAAN,GAAYA,GAAZ;WACKF,eAAL,CAAqBK,IAArB,CAA0BH,GAA1B;WACKF,eAAL,CAAqBM,IAArB,CAA0BC,SAA1B;YACMC,WAAW,KAAKR,eAAL,CAAqBS,OAArB,CAA6BP,GAA7B,CAAjB;YACMQ,oBACJF,WAAW,KAAKR,eAAL,CAAqB/B,MAArB,GAA8B,CAAzC,GACI,KAAK+B,eAAL,CAAqBQ,WAAW,CAAhC,CADJ,GAEI,KAAK,CAHX;WAIKP,MAAL,CAAYC,GAAZ,IAAmBC,KAAnB;WACKL,UAAL,CAAgBI,GAAhB,EAAqBC,KAArB,EAA4BO,iBAA5B;;;WAEK,KAAKT,MAAL,CAAYC,GAAZ,CAAP;;;uBAGmB;WACZ,KAAKF,eAAZ;;;;AAIJ,AAAO,MAAMI,KAAN,CAAe;cAOlBP,WADF,EAEEE,UAFF,EAGE;SACKI,KAAL,GAAa,EAAb;SACKN,WAAL,GAAmBA,WAAnB;SACKE,UAAL,GAAkBA,UAAlB;;;WAGOG,GAAT,EAAsBS,KAAtB,EAAgC;UACxBC,SAAS,KAAKT,KAAL,CAAWD,GAAX,CAAf;;QACIU,MAAJ,EAAY;aACHA,MAAP;;;UAEInE,KAAK,KAAKoD,WAAL,CAAiBgB,IAAjB,EAAX;SACKV,KAAL,CAAWD,GAAX,IAAkBzD,EAAlB;SACKsD,UAAL,CAAgB,IAAhB,EAAsBtD,EAAtB,EAA0BkE,KAA1B;WACOlE,EAAP;;;;;ACnEJ,MAAMqE,mBAAmB,QAAzB;AACA,MAAMC,YAAY,MAAlB;AACA,MAAMZ,QAAQ,EAAd;AAEA,AAAe,SAASa,kBAAT,CAA4BC,IAA5B,EAAkD;SACxDA,QAAQd,KAAR,GACHA,MAAMc,IAAN,CADG,GAEFd,MAAMc,IAAN,IAAcA,KACZC,OADY,CACJJ,gBADI,EACc,KADd,EAEZK,WAFY,GAGZD,OAHY,CAGJH,SAHI,EAGO,MAHP,CAFnB;;;ACLF;;;AAIA,AAEA,MAAMK,eAAe;;gBAEL,CAAC,iBAAD,EAAoB,qBAApB,EAA2C,kBAA3C,CAFK;UAGX,CAAC,YAAD,EAAe,cAAf,EAA+B,eAA/B,EAAgD,aAAhD,CAHW;WAIV,CAAC,eAAD,EAAkB,eAAlB,EAAmC,eAAnC,CAJU;WAKV,CAAC,aAAD,EAAgB,eAAhB,EAAiC,gBAAjC,EAAmD,cAAnD,CALU;;cAQP,CACV,kBADU,EAEV,qBAFU,EAGV,iBAHU,EAIV,mBAJU,EAKV,mBALU,EAMV,iBANU,EAOV,uBAPU,EAQV,kBARU,CARO;UAkBX,CACN,kBADM,EAEN,oBAFM,EAGN,qBAHM,EAIN,mBAJM,EAKN,cALM,EAMN,kBANM,EAON,oBAPM,EAQN,qBARM,EASN,mBATM,EAUN,cAVM,EAWN,kBAXM,EAYN,oBAZM,EAaN,qBAbM,EAcN,mBAdM,EAeN,cAfM,CAlBW;kBAmCH,CACd,kBADc,EAEd,oBAFc,EAGd,qBAHc,EAId,mBAJc,CAnCG;kBAyCH,CACd,kBADc,EAEd,oBAFc,EAGd,qBAHc,EAId,mBAJc,CAzCG;kBA+CH,CACd,kBADc,EAEd,oBAFc,EAGd,qBAHc,EAId,mBAJc,CA/CG;gBAqDL,CAAC,kBAAD,EAAqB,kBAArB,EAAyC,kBAAzC,CArDK;kBAsDH,CACd,oBADc,EAEd,oBAFc,EAGd,oBAHc,CAtDG;mBA2DF,CACf,qBADe,EAEf,qBAFe,EAGf,qBAHe,CA3DE;iBAgEJ,CACb,mBADa,EAEb,mBAFa,EAGb,mBAHa,CAhEI;mBAqEF,CACf,wBADe,EAEf,yBAFe,EAGf,4BAHe,EAIf,2BAJe,CArEE;kBA2EH,CACd,qBADc,EAEd,oBAFc,EAGd,oBAHc,EAId,qBAJc,EAKd,qBALc,CA3EG;;QAoFb,CACJ,YADI,EAEJ,wBAFI,EAGJ,yBAHI,EAIJ,mBAJI,EAKJ,sBALI,EAMJ,yBANI,EAOJ,cAPI,EAQJ,aARI,EASJ,cATI,EAUJ,WAVI,EAWJ,aAXI,EAYJ,aAZI,CApFa;kBAkGH,CACd,wBADc,EAEd,yBAFc,EAGd,mBAHc,EAId,sBAJc,EAKd,yBALc,CAlGG;;QA2Gb,CAAC,WAAD,EAAc,aAAd,EAA6B,YAA7B,CA3Ga;eA4GN,CAAC,gBAAD,EAAmB,WAAnB,CA5GM;;QA+Gb,CACJ,oBADI,EAEJ,uBAFI,EAGJ,qBAHI,EAIJ,gBAJI,EAKJ,mBALI,EAMJ,gBANI,CA/Ga;mBAuHF,CACf,oBADe,EAEf,uBAFe,EAGf,qBAHe,CAvHE;cA4HP,CAAC,gBAAD,EAAmB,cAAnB,CA5HO;iBA6HJ,CAAC,mBAAD,EAAsB,iBAAtB,CA7HI;eA8HN,CACX,gBADW,EAEX,mBAFW,EAGX,cAHW,EAIX,iBAJW,CA9HM;cAoIP,CAAC,cAAD,EAAiB,iBAAjB,CApIO;;QAuIb,CACJ,YADI,EAEJ,WAFI,EAGJ,eAHI,EAIJ,WAJI,EAKJ,aALI,EAMJ,aANI,EAOJ,WAPI,CAvIa;iBAgJJ,CACb,oBADa,EAEb,mBAFa,EAGb,mBAHa,EAIb,oBAJa,EAKb,oBALa,EAMb,kBANa,CAhJI;;WA0JV,CAAC,cAAD,EAAiB,cAAjB,CA1JU;iBA2JJ,CACb,mBADa,EAEb,mBAFa,EAGb,mBAHa,CA3JI;;oBAkKD,CAChB,oBADgB,EAEhB,sBAFgB,EAGhB,uBAHgB,EAIhB,qBAJgB,CAlKC;0BAwKK,CACtB,4BADsB,EAEtB,0BAFsB,CAxKL;2BA4KM,CACvB,6BADuB,EAEvB,2BAFuB,CA5KN;wBAgLG,CACpB,wBADoB,EAEpB,0BAFoB,EAGpB,2BAHoB,EAIpB,yBAJoB,CAhLH;8BAsLS,CAC1B,gCAD0B,EAE1B,8BAF0B,CAtLT;+BA0LU,CAC3B,iCAD2B,EAE3B,+BAF2B,CA1LV;;OAgMd,CAAC,YAAD,EAAe,WAAf,CAhMc;SAiMZ,CAAC,cAAD,EAAiB,aAAjB,CAjMY;QAkMb,CAAC,aAAD,EAAgB,YAAhB,CAlMa;;qBAqMA,CACjB,sBADiB,EAEjB,uBAFiB,EAGjB,uBAHiB,CArMA;mBA0MF,CAAC,qBAAD,EAAwB,qBAAxB,CA1ME;;aA6MR,CACT,gBADS,EAET,oBAFS,EAGT,2BAHS,EAIT,iBAJS,EAKT,2BALS,EAMT,qBANS,EAOT,qBAPS,EAQT,sBARS,CA7MQ;;cAyNP,CACV,qBADU,EAEV,qBAFU,EAGV,4BAHU,EAIV,kBAJU;CAzNd;AAiOA,AAAO,SAASC,mBAAT,CAA6BC,KAA7B,EAA4C;QAC3CC,uBAAuBC,OAAOC,IAAP,CAAYH,KAAZ,EAAmBI,MAAnB,CAA0B,CAACC,GAAD,EAAMC,QAAN,KAAmB;QACpEC,mBAAUD,QAAV,CAAJ,IAA2BA,QAA3B;WACOD,GAAP;GAF2B,EAG1B,EAH0B,CAA7B;QAKMG,QAAQ,EAAd;;OACK,MAAMF,QAAX,IAAuBL,oBAAvB,EAA6C;QACvCK,YAAYR,YAAhB,EAA8B;WACvB,MAAMW,QAAX,IAAuBX,aAAaQ,QAAb,CAAvB,EAA+C;YACzCG,YAAYR,oBAAhB,EAAsC;gBAC9BS,OAAOT,qBAAqBQ,QAArB,CAAb;gBACME,QAAQV,qBAAqBK,QAArB,CAAd;gBACMvB,IAAN,CAAW;uBACE;wBAAW4B,KAAX;qBAAyBX,MAAMW,KAAN;aAD3B;sBAEC;wBAAWD,IAAX;qBAAwBV,MAAMU,IAAN;;WAFpC;;;;;;SAQDF,KAAP;;;AClPa,SAASI,mBAAT,CACbC,UADa,EAEbC,MAFa,EAGbC,KAHa,EAIbC,MAJa,EAKb;QACMnC,QAAQgC,WAAWI,QAAX,CAAoBF,KAApB,CAAd;MACIG,cAAc,EAAlB;;OACK,MAAMC,WAAX,IAA0BL,MAA1B,EAAkC;UAC1BM,cAAcN,OAAOK,WAAP,CAApB;;QAEIC,gBAAgB,KAAK,CAArB,IAA0BA,gBAAgB,IAA9C,EAAoD;;;;QAGhD,OAAOA,WAAP,KAAuB,QAA3B,EAAqC;;iDAEtB;0BACOA,WAAlB,EAA+BD,WAA/B;;;YAGIE,cAAe,GAAEd,mBACrBY,WADqB,CAErB,IAAKC,WAA2B,EAFlC;YAGMxC,MAAO,GAAEoC,MAAO,GAAEK,WAAY,EAApC;YACMC,WAAWzC,MAAMA,KAAN,CAAYD,GAAZ,CAAjB;;UACI0C,aAAa,KAAK,CAAtB,EAAyB;;uBAER,MAAMA,QAArB;;OAFF,MAIO;;YAEDC,QAAQ,EAAZ;cACMC,WAAW1G,2BAAO;WAAEqG,WAAD,GAAeC;SAAvB,CAAjB;;aACK,MAAMK,WAAX,IAA0BD,QAA1B,EAAoC;gBAC5BE,cAAcF,SAASC,WAAT,CAApB;gBACME,kBAAkB,OAAOD,WAA/B;;cACIC,oBAAoB,QAApB,IAAgCA,oBAAoB,QAAxD,EAAkE;kBAC1DC,eAAgB,GAAErB,mBAAUkB,WAAV,CAAuB,IAAGC,WAAY,EAA9D;;gBACIE,iBAAiBP,WAArB,EAAkC;uBACtB,GAAEO,YAAa,GAAzB;;WAHJ,MAKO,IAAIC,MAAMC,OAAN,CAAcJ,WAAd,CAAJ,EAAgC;kBAC/BK,aAAaxB,mBAAUkB,WAAV,CAAnB;;iBACK,IAAIO,IAAI,CAAb,EAAgBA,IAAIN,YAAY/E,MAAhC,EAAwCqF,GAAxC,EAA6C;oBACrCJ,eAAgB,GAAEG,UAAW,IAAGL,YAAYM,CAAZ,CAAe,EAArD;;kBACIJ,iBAAiBP,WAArB,EAAkC;yBACtB,GAAEO,YAAa,GAAzB;;;;;;iBAKCP,WAAT,CAtBK;;cAuBClG,KAAK0D,MAAMoD,QAAN,CAAerD,GAAf,EAAoB;gBAAA;;SAApB,CAAX;uBACe,MAAMzD,EAArB;;KAvCJ,MAyCO;;UAEDgG,YAAY,CAAZ,MAAmB,GAAvB,EAA4B;uBAExB,MACAP,oBACEC,UADF,EAEEO,WAFF,EAGEL,KAHF,EAIEC,SAASG,WAJX,CAFF;OADF,MASO,IAAIA,YAAYe,SAAZ,CAAsB,CAAtB,EAAyB,CAAzB,MAAgC,QAApC,EAA8C;uBAEjD,MACAtB,oBACEC,UADF,EAEEO,WAFF,EAGED,YAAYgB,MAAZ,CAAmB,CAAnB,CAHF,EAIEnB,MAJF,CAFF;;;;;6CAYO;UACLoB,YAAYrC,oBAAoBe,MAApB,CAAlB;;QACIsB,UAAUzF,MAAd,EAAsB;gBACV0F,OAAV,CAAkB,CAAC;iBAAA;;OAAD,KAA2B;cACrC1B,QAAQ2B,KAAKC,SAAL,CAAe;WAAEC,UAAUlC,QAAX,GAAsBkC,UAAUnD;SAAhD,CAAd;cACMqB,OAAO4B,KAAKC,SAAL,CAAe;WAAE9B,SAASH,QAAV,GAAqBG,SAASpB;SAA9C,CAAb,CAF2C;;gBAInCoD,IAAR,CACG,YAAW9B,KAAM,YAAWD,IAAK,gCAA+BQ,YAAYwB,KAAZ,CAC/D,CAD+D,CAE/D,kJAHJ;OAJF;;GA7EJ;;;SA2FOxB,YAAYwB,KAAZ,CAAkB,CAAlB,CAAP;;;AAGF,SAASC,iBAAT,CAA2BtD,KAA3B,EAAkCT,GAAlC,EAAuC;MAEnCS,UAAU,IAAV,IACAwC,MAAMC,OAAN,CAAczC,KAAd,CADA,IAEC,OAAOA,KAAP,KAAiB,QAAjB,IAA6B,OAAOA,KAAP,KAAiB,QAHjD,EAIE;UACM,IAAIuD,KAAJ,CACH,4BAA2BN,KAAKC,SAAL,CAC1BlD,KAD0B,CAE1B,qBAAoBiD,KAAKC,SAAL,CAAe3D,GAAf,CAAoB,EAHtC,CAAN;;;;ACnHJ;AAEA,MAAMiE,sBAAsB,gEAA5B;AAEA,AAAe,SAASC,uBAAT,CAAiCC,SAAjC,EAAoD;MAC7DC,QAAQ,IAAZ;;OACK,MAAMC,cAAX,IAA6BF,SAA7B,EAAwC;UAChC1D,QAAQ0D,UAAUE,cAAV,CAAd;;QACI,CAACJ,oBAAoBxF,IAApB,CAAyB4F,cAAzB,CAAL,EAA+C;cACrC,KAAR;cACQR,IAAR,CACG,sBAAqBQ,cAAe,yBAAwBX,KAAKC,SAAL,CAC3DQ,SAD2D,CAE3D,yDAHJ;;;QAME,OAAO1D,KAAP,KAAiB,QAArB,EAA+B;cACrB,KAAR;cACQoD,IAAR,CACG,uBAAsBQ,cAAe,kCAAiCX,KAAKC,SAAL,CACrEQ,SADqE,CAErE,wCAAuC,OAAO1D,KAAM,GAHxD;;;QAME,CAAC2D,KAAL,EAAY;cACFP,IAAR,CACG,qEADH,EAEEM,SAFF;;;;;ACpBC,SAASG,cAAT,CAAwB/H,EAAxB,EAAoC6F,MAApC,EAA4D;MAC7DmC,WAAY,IAAGhI,EAAG,EAAtB;;MACI6F,MAAJ,EAAY;gBACEA,MAAZ;;;SAEKmC,QAAP;;AAGF,AAAO,SAASC,gBAAT,CAA0BL,SAA1B,EAAiE;6CACzD;4BACaA,SAAxB;;;MAEE,yCAAW,OAAO7C,OAAOmD,cAAP,CAAsBN,SAAtB,CAAP,KAA4C,WAA3D,EAAwE;QAClE7C,OAAOmD,cAAP,CAAsBN,SAAtB,MAAqC7C,OAAOmD,cAAP,CAAsB,EAAtB,CAAzC,EAAoE;;cAE1DZ,IAAR,CACE,+EADF,EAEEM,SAFF;;;;MAMAO,SAAS,EAAb;;OACK,MAAML,cAAX,IAA6BF,SAA7B,EAAwC;cAC3B,GAAEE,cAAe,IAAGM,oBAC7BR,UAAUE,cAAV,CAD6B,CAE7B,GAFF;;;SAIKK,MAAP;;AAGF,AAAO,SAASC,mBAAT,CAA6BvD,KAA7B,EAAoD;MACrDwD,MAAM,EAAV;;OACK,MAAM7D,IAAX,IAAmBK,KAAnB,EAA0B;UAClByD,MAAMzD,MAAML,IAAN,CAAZ;;QACI,OAAO8D,GAAP,KAAe,QAAf,IAA2B,OAAOA,GAAP,KAAe,QAA9C,EAAwD;aAC9C,GAAElD,mBAAUZ,IAAV,CAAgB,IAAG8D,GAAI,GAAjC;;GALqD;;;SASlDD,IAAId,KAAJ,CAAU,CAAV,EAAa,CAAC,CAAd,CAAP;;AAGF,AAAO,SAASgB,oBAAT,CAA8BvI,EAA9B,EAA0CoG,KAA1C,EAAiE;SAC9D,cAAapG,EAAG,IAAGoG,KAAM,GAAjC;;AAGF,AAAO,SAASoC,mBAAT,CAA6BxI,EAA7B,EAAyCoG,KAAzC,EAAgE;SAC7D,0BAAyBpG,EAAG,IAAGoG,KAAM,GAA7C;;AAGF,AAAO,SAASqC,gBAAT,CAA0BT,QAA1B,EAA4C5B,KAA5C,EAAmE;SAChE,GAAE4B,QAAS,IAAG5B,KAAM,GAA5B;;;AC1DF;;ACEA;AAKA,MAAMsC,kBAAkB,2CAAxB;AACA,MAAMC,qBAAqB,8CAA3B;AACA,MAAMC,qBAAqB,4CAA3B;;AAOA,SAASC,aAAT,CAA0BnF,KAA1B,EAA2CoF,QAA3C,EAAgET,GAAhE,EAA6E;MACvEU,KAAJ;;SACQA,QAAQD,SAASpH,IAAT,CAAc2G,GAAd,CAAhB,EAAqC;UAC7B,GAAGrI,EAAH,EAAO6F,MAAP,EAAepC,GAAf,IAAsBsF,KAA5B;;UAIMC,UAAUnD,SAAU,GAAEA,MAAO,GAAEpC,GAAI,EAAzB,GAA6BA,GAA7C;UACMC,KAAN,CAAYsF,OAAZ,IAAuBhJ,EAAvB,CANmC;;UAO7BoD,WAAN,CAAkBnD,SAAlB,GAPmC;;;;AAWvC,SAASgJ,OAAT,CAAoBvF,KAApB,EAAqCoF,QAArC,EAA0DT,GAA1D,EAAuE;MACjEU,KAAJ;;SACQA,QAAQD,SAASpH,IAAT,CAAc2G,GAAd,CAAhB,EAAqC;UAC7B,GAAGrI,EAAH,EAAOyD,GAAP,IAAcsF,KAApB;;UAIMrF,KAAN,CAAYD,GAAZ,IAAmBzD,EAAnB,CALmC;;UAM7BoD,WAAN,CAAkBnD,SAAlB,GANmC;;;;AAUvC,AAkCA,MAAMiJ,eAAN,CAAgD;cAUlCC,OAAkB,EAA9B,EAAkC;SAC3BC,aAAL,GAAqB,EAArB;UAEMC,mBAAmB,IAAI3J,qBAAJ,CAA0ByJ,KAAKxJ,MAA/B,CAAzB;;UACM2J,aAAa,CAAC5F,KAAD,EAAQ1D,EAAR,EAAYkE,KAAZ,KAAsB;YACjC;cAAA;;UAAkBA,KAAxB;YACMqF,QAAwB,KAAKH,aAAL,CAAmB1F,MAAMD,GAAzB,EAA8B8F,KAA5D;YACMvB,WAAWD,eAAe/H,EAAf,EAAmB6F,MAAnB,CAAjB;YACM2D,OAAOf,iBAAiBT,QAAjB,EAA2B5B,KAA3B,CAAb;;UACI;cACIqD,UAAN,CAAiBD,IAAjB,EAAuBD,MAAMG,QAAN,CAAelI,MAAtC;;;OADF,CAKE,OAAOmI,CAAP,EAAU;mDACG;;kBAEHrC,IAAR,CACG,0BAAyBkC,IAAK,wDADjC;;;KAbN,CAJgC;;;SAyB3B9D,UAAL,GAAkB,IAAIvC,UAAJ,CAChBkG,gBADgB,EAEhB,CAACzD,KAAD,EAAQgE,MAAR,EAAgB3F,iBAAhB,KAAsC;YAC9B4F,eAAeC,SAASC,aAAT,CAAuB,OAAvB,CAArB;mBACanE,KAAb,GAAqBA,KAArB;;UACI3B,sBAAsB,KAAK,CAA/B,EAAkC;aAC3B+F,SAAL,CAAeC,WAAf,CAA2BJ,YAA3B;OADF,MAEO;cACCK,oBAAoBC,wBACxB,KAAKH,SAAL,CAAeI,QADS,EAExBnG,iBAFwB,CAA1B;aAIK+F,SAAL,CAAeK,YAAf,CACER,YADF,EAEE,KAAKG,SAAL,CAAeI,QAAf,CAAwBF,iBAAxB,CAFF;;;WAMGd,aAAL,CAAmBxD,KAAnB,IAA4BiE,YAA5B;KAlBc,EAoBhBP,UApBgB,CAAlB;SAuBKgB,cAAL,GAAsB,IAAI3G,KAAJ,CACpB,IAAIjE,qBAAJ,CAA0ByJ,KAAKxJ,MAA/B,CADoB,EAEpB,CAAC+D,KAAD,EAAQ1D,EAAR,EAAYkE,KAAZ,KAAsB;WACfwB,UAAL,CAAgBI,QAAhB,CAAyB,EAAzB;YACMyD,QAAwB,KAAKH,aAAL,CAAmB,EAAnB,EAAuBG,KAArD;YACMC,OAAOjB,qBAAqBvI,EAArB,EAAyBiI,iBAAiB/D,KAAjB,CAAzB,CAAb;;UACI;cACIuF,UAAN,CAAiBD,IAAjB,EAAuBD,MAAMG,QAAN,CAAelI,MAAtC;OADF,CAEE,OAAOmI,CAAP,EAAU;mDACG;;kBAEHrC,IAAR,CACG,0BAAyBkC,IAAK,wDADjC;;;KAXc,CAAtB;SAmBKe,aAAL,GAAqB,IAAI5G,KAAJ,CACnB,IAAIjE,qBAAJ,CAA0ByJ,KAAKxJ,MAA/B,CADmB,EAEnB,CAAC+D,KAAD,EAAQ1D,EAAR,EAAYkE,KAAZ,KAAsB;WACfwB,UAAL,CAAgBI,QAAhB,CAAyB,EAAzB;YACMyD,QAAwB,KAAKH,aAAL,CAAmB,EAAnB,EAAuBG,KAArD;YACMC,OAAOhB,oBAAoBxI,EAApB,EAAwBoI,oBAAoBlE,KAApB,CAAxB,CAAb;;UACI;cACIuF,UAAN,CAAiBD,IAAjB,EAAuBD,MAAMG,QAAN,CAAelI,MAAtC;OADF,CAEE,OAAOmI,CAAP,EAAU;mDACG;;kBAEHrC,IAAR,CACG,0BAAyBkC,IAAK,wDADjC;;;KAXa,CAArB;;QAmBIL,KAAKa,SAAT,EAAoB;WACbA,SAAL,GAAiBb,KAAKa,SAAtB;KAvF8B;;;QA2F5Bb,KAAKF,OAAL,IAAgBE,KAAKF,OAAL,CAAazH,MAAb,GAAsB,CAA1C,EAA6C;;UAEvC,CAAC,KAAKwI,SAAV,EAAqB;cACbQ,gBAAgBrB,KAAKF,OAAL,CAAa,CAAb,EAAgBuB,aAAtC;;YACIA,kBAAkB,IAAlB,IAA0BA,kBAAkB,KAAK,CAArD,EAAwD;eACjDR,SAAL,GAAiBQ,aAAjB;;;;WAIC,IAAI3D,IAAI,CAAb,EAAgBA,IAAIsC,KAAKF,OAAL,CAAazH,MAAjC,EAAyCqF,GAAzC,EAA8C;cACtC4D,UAAUtB,KAAKF,OAAL,CAAapC,CAAb,CAAhB;cACM6D,cAAcD,QAAQE,YAAR,CAAqB,cAArB,CAApB;;YACID,gBAAgB,WAApB,EAAiC;kBACvB,KAAKH,aAAb,EAA4B3B,kBAA5B,EAAgD6B,QAAQG,WAAxD;;;;YAGEF,gBAAgB,WAApB,EAAiC;kBACvB,KAAKJ,cAAb,EAA6B3B,kBAA7B,EAAiD8B,QAAQG,WAAzD;;;;cAGInH,MAAMgH,QAAQ7E,KAAR,GAAgB6E,QAAQ7E,KAAxB,GAAgC,EAA5C;aACKwD,aAAL,CAAmB3F,GAAnB,IAA0BgH,OAA1B;cACM/G,QAAQ,IAAIC,KAAJ,CAAU0F,gBAAV,EAA4BC,UAA5B,CAAd;cACM7F,GAAN,GAAYA,GAAZ;sBACcC,KAAd,EAAqBgF,eAArB,EAAsC+B,QAAQG,WAA9C;aACKlF,UAAL,CAAgBnC,eAAhB,CAAgCK,IAAhC,CAAqCH,GAArC;aACKiC,UAAL,CAAgBlC,MAAhB,CAAuBC,GAAvB,IAA8BC,KAA9B;;;;QAIA,CAAC,KAAKsG,SAAV,EAAqB;UACfF,SAASe,IAAT,KAAkB,IAAtB,EAA4B;cACpB,IAAIpD,KAAJ,CAAU,oDAAV,CAAN;;;WAEGuC,SAAL,GAAiBF,SAASe,IAA1B;;;;cAIQhG,KAAZ,EAAwC;WAC/BY,oBAAoB,KAAKC,UAAzB,EAAqCb,KAArC,EAA4C,EAA5C,EAAgD,EAAhD,CAAP;;;iBAGaiG,QAAf,EAAiD;UACzCrH,MAAM2E,oBAAoB0C,QAApB,CAAZ;WACO,KAAKP,aAAL,CAAmBzD,QAAnB,CAA4BrD,GAA5B,EAAiCqH,QAAjC,CAAP;;;kBAGclD,SAAhB,EAAoD;UAC5CnE,MAAMwE,iBAAiBL,SAAjB,CAAZ;WACO,KAAK0C,cAAL,CAAoBxD,QAApB,CAA6BrD,GAA7B,EAAkCmE,SAAlC,CAAP;;;;;AAIJ,AAEA,SAASuC,uBAAT,CAAiCC,QAAjC,EAA2CxE,KAA3C,EAAkD;MAC5CmF,QAAQ,CAAZ;;SACOA,QAAQX,SAAS5I,MAAxB,EAAgCuJ,OAAhC,EAAyC;UACjCC,QAAQZ,SAASW,KAAT,CAAd;;QAEEC,MAAMC,OAAN,KAAkB,OAAlB,IACED,KAAF,CAAiCpF,KAAjC,KAA2CA,KAF7C,EAGE;aACOmF,KAAP;;;;SAIG,CAAC,CAAR;;;;;ACjPF,AAsCA,MAAMG,eAAN,CAAgD;cAQlC/B,OAAkB,EAA9B,EAAkC;SAC3BgC,UAAL,GAAkB;UAAK;KAAvB;SACKzF,UAAL,GAAkB,IAAIvC,UAAJ,CAChB,IAAIzD,qBAAJ,CAA0ByJ,KAAKxJ,MAA/B,CADgB,EAEhBiG,SAAS;WACFuF,UAAL,CAAgBvF,KAAhB,IAAyB,EAAzB;KAHc,EAKhB,CAAClC,KAAD,EAAQ1D,EAAR,EAAYkE,KAAZ,KAAsB;YACd;cAAA;;UAAkBA,KAAxB;WACKiH,UAAL,CAAgBzH,MAAMD,GAAtB,KAA8BgF,iBAC5BV,eAAe/H,EAAf,EAAmB6F,MAAnB,CAD4B,EAE5BO,KAF4B,CAA9B;KAPc,CAAlB;SAcKgF,aAAL,GAAqB,EAArB;SACKb,aAAL,GAAqB,IAAI5G,KAAJ,CACnB,IAAIjE,qBAAJ,CAA0ByJ,KAAKxJ,MAA/B,CADmB,EAEnB,CAAC+D,KAAD,EAAQ1D,EAAR,EAAYkE,KAAZ,KAAsB;WACfkH,aAAL,IAAsB5C,oBACpBxI,EADoB,EAEpBoI,oBAAoBlE,KAApB,CAFoB,CAAtB;KAHiB,CAArB;SAUKmH,cAAL,GAAsB,EAAtB;SACKf,cAAL,GAAsB,IAAI3G,KAAJ,CACpB,IAAIjE,qBAAJ,CAA0ByJ,KAAKxJ,MAA/B,CADoB,EAEpB,CAAC+D,KAAD,EAAQ1D,EAAR,EAAYkE,KAAZ,KAAsB;WACfmH,cAAL,IAAuB9C,qBACrBvI,EADqB,EAErBiI,iBAAiB/D,KAAjB,CAFqB,CAAvB;KAHkB,CAAtB;;;cAWUW,KAAZ,EAAwC;WAC/BY,oBAAoB,KAAKC,UAAzB,EAAqCb,KAArC,EAA4C,EAA5C,EAAgD,EAAhD,CAAP;;;iBAGaiG,QAAf,EAAiD;UACzCrH,MAAM0D,KAAKC,SAAL,CAAe0D,QAAf,CAAZ;WACO,KAAKP,aAAL,CAAmBzD,QAAnB,CAA4BrD,GAA5B,EAAiCqH,QAAjC,CAAP;;;kBAGclD,SAAhB,EAAoD;UAC5CnE,MAAM0D,KAAKC,SAAL,CAAeQ,SAAf,CAAZ;WACO,KAAK0C,cAAL,CAAoBxD,QAApB,CAA6BrD,GAA7B,EAAkCmE,SAAlC,CAAP;;;mBAG8B;WACvB,CACL,IAAI,KAAKyD,cAAL,CAAoB7J,MAApB,GACA,CACE;WACO,KAAK6J,cADZ;aAES;wBAAiB;;KAH5B,CADA,GAOA,EAPJ,CADK,EASL,IAAI,KAAKD,aAAL,CAAmB5J,MAAnB,GACA,CACE;WACO,KAAK4J,aADZ;aAES;wBAAiB;;KAH5B,CADA,GAOA,EAPJ,CATK,EAiBL,GAAGE,SAAS,KAAKH,UAAd,EAA0B,KAAKzF,UAAL,CAAgB6F,kBAAhB,EAA1B,CAjBE,CAAP;;;qBAqBiBC,YAAqB,qBAAxC,EAA+D;WACtDC,mBAAmB,KAAKC,cAAL,EAAnB,EAA0CF,SAA1C,CAAP;;;WAGO;WAEL,KAAKH,cAAL,GACA,KAAKD,aADL,GAEAhE,UAAU,KAAK+D,UAAf,EAA2B,KAAKzF,UAAL,CAAgB6F,kBAAhB,EAA3B,CAHF;;;;;AAQJ,AAAO,SAASE,kBAAT,CAA4BE,MAA5B,EAAmDH,SAAnD,EAAsE;MACvEI,OAAO,EAAX;;OACK,IAAI/E,IAAI,CAAb,EAAgBA,IAAI8E,OAAOnK,MAA3B,EAAmCqF,GAAnC,EAAwC;UAChC0C,QAAQoC,OAAO9E,CAAP,CAAd;;yBAC4C0C,MAAMsC,KAAlD;UAAM;aAAQC;KAAd;UAAoCC,IAApC;;UACMF;aACGC,oBACF,GAAEN,SAAU,IAAGM,iBAAkB,EAD/B,GAEHN;OACAO,IAJA,CAAN;YAMS,SAAQC,cAAcH,KAAd,CAAqB,IAAGtC,MAAMlB,GAAI,UAAnD;;;SAEKuD,IAAP;;;AAGF,SAASI,aAAT,CAAuBH,KAAvB,EAAsC;MAChC1D,SAAS,EAAb;;OACK,MAAM8D,IAAX,IAAmBJ,KAAnB,EAA0B;UAClB3H,QAAQ2H,MAAMI,IAAN,CAAd;;QACI/H,UAAU,IAAd,EAAoB;gBACR,MAAM+H,IAAhB;KADF,MAEO,IAAI/H,UAAU,KAAd,EAAqB;gBACf,IAAG+H,IAAK,KAAI/H,KAAM,GAA7B;;;;SAGGiE,MAAP;;;AAGF,SAASf,SAAT,CAAmB+D,UAAnB,EAA+B5H,eAA/B,EAAgD;MAC1C4E,SAAS,EAAb;kBACgBjB,OAAhB,CAAwBgF,YAAY;UAC5BC,QAAQhB,WAAWe,QAAX,CAAd;;QACIA,aAAa,EAAjB,EAAqB;gBACR,UAASA,QAAS,IAAGC,KAAM,GAAtC;KADF,MAEO;gBACKA,KAAV;;GALJ;SAQOhE,MAAP;;;AAGF,SAASmD,QAAT,CAAkBH,UAAlB,EAA8B5H,eAA9B,EAA8D;MACxDA,gBAAgB/B,MAAhB,KAA2B,CAA/B,EAAkC;WACzB,CAAC;WAAM,EAAN;aAAiB;KAAlB,CAAP;;;QAEImK,SAAS,EAAf;kBACgBzE,OAAhB,CAAwBgF,YAAY;;UAE5BL,QAAQK,aAAa,EAAb,GAAkB,EAAlB,GAAuB;aAAQA;KAA7C;WACOtI,IAAP,CAAY;WAAMuH,WAAWe,QAAX,CAAN;;KAAZ;GAHF;SAKOP,MAAP;;;;;;"}